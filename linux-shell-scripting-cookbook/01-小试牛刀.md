# 01-小试牛刀

---

- [终端打印](#终端打印)
- [玩转变量与环境变量](#玩转变量与环境变量)
- [数学运算](#数学运算)
- [文件描述符和重定向](#文件描述符和重定向)
- [数组](#数组)
- [关联数组](#关联数组)
- [别名](#别名)
- [终端信息](#终端信息)

---

## 终端打印

* 不带引号的`echo` - 不会将含有空格的字符串视作整体输出
* 带单引号的`echo` - 所见即所得，内容原样输出
* 带双引号的`echo` - 如果内容中有命令、变量，会先**解析**再输出 

注意，`echo`会默认将一个换行符追加到输出文本末尾，可以使用`-n`来忽略结尾换行符！如需使用**转义序列**，则采用`echo -e "包含转义序列的字符串"`的形式！

## 玩转变量与环境变量

环境变量是未在当前进程中定义，从父进程继承来的变量！`export`命令用来设置环境变量，此后，从**当前**脚本执行的任何程序都会继承这个变量！

```bash
# 查看进程在运行时的环境变量
pgrep gedit
# $PID为上述命令返回的具体数字
# 默认返回以null即\0分割，将\0替换为\n重新格式化
cat /proc/$PID/environ | tr '\0' '\n'
```

* 变量**赋值**和**判等** - `var=value` vs `var = value`
* 变量**取值** - `echo $var` 或 `echo ${var}` 
* 获得**字符串长度** - `length=${#var}`
* 识别**当前**`Shell` - `echo $SHELL`
* 检查是否为**超级用户** - `if [ $UID -ne 0]`，`root`用户的`UID`为0

## 数学运算

* 整数运算

```bash
# let - 变量名之前不需要再添加$
let result=no1+no2
let result++
let result--

# [] - []中变量可以添加$也可以不添加$
result=$[no1+no2]
result=$[$no1+5]

# (())
result=$((no1+1))
result=$(($no1+1))
```

* 浮点数运算

```bash
echo "4 * 0.56" | bc

# 其他参数可置于要执行的具体操作前，以分号为定界符，通过stdin传给bc

# 设定小数精度
echo "scale=2;3/8" | bc => 0.37

# 进制转换
echo "obase=2;100" | bc => 1100100

# 平方/平方根
echo "sqrt(100)" | bc => 10
echo "10^2" | bc => 100
```

## 文件描述符和重定向

文件描述符是与**打开的文件或数据流**相关联的**整数**，系统预留了`0 - stdin`，`1 - stdout`，`2 - stderr`！

* `>` - 清空并输出到目标文件，等同于`1>`
* `>>` - 追加到目标文件，等同于`1>>`
* `<` - 从文件中读取到`stdin`
* `cmd 2>stderr.txt 1>stdout.txt` - 标准错误和标准输出分别重定向到两个文件
* `2>&1` - `2`重定向到**等同于**`1`的文件中
* `ls | tee out.txt | cat -n` - `tee -> T`，把数据重定向到文件**同时**提供**重定向数据的副本**为后续命令的`stdin`

## 数组

* 单行定义数组 - `array=(1 2 3)`
* 多行定义数组 - `array[0]=1 array[1]=2`，注意，`bash`数组下标从0开始，`zsh`数组下标从1开始
* 打印数组清单 - `echo ${array[*]}`或`echo ${array[@]}`
* 打印数组长度 - `echo ${#array[*]}`

## 关联数组

1. 单独声明语句将变量名声明为关联数组 - `declare -A ass_arr`
2. 内嵌索引法定义关联数组 - `ass_arr=([idx1]=var1 [idx2]=var2)`
3. 独立索引法定义关联数组 - `ass_arr[idx1]=var1 ass_arr[idx2]=var2`
4. 列出数组索引 - `echo ${!ass_arr[*]}`或`echo ${!ass_arr[@]}`


## 别名

`alias install='sudo apt-get install'` 

`alias`作用是暂时的，一旦关闭终端，设置的别名就失效了！如果想一直有效，则需要把设置放到`~/.bashrc`或`~/.zshrc`中去，因为每次开一个新的`shell`进程都会执行`~/.bashrc`或`~/.zshrc`中的命令！

注意！安全问题！攻击者可能利用别名将**某些特权命令替换成别有用心的命令**，以此盗取用户输入的重要信息！因此可以对命令转义`\cmd`，使得**执行命令本身而不是别名替身**！

## 终端信息

* 获取终端行数和列数 - `tput lines`和`tput cols`
* 将光标移动到(100, 100) - `tput cup 100 100`
* 输入密码时不显示内容

```bash
#!/bin/sh
echo -e "Enter password: "
#禁止将输出发送到终端
stty -echo
read password
#允许将输出发送到终端
stty echo
echo "Password read"
```

